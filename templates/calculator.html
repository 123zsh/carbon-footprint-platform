<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>碳足迹计算器 - 企业碳足迹平台</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }
        
        .navbar {
            background: linear-gradient(135deg, #1a237e 0%, #283593 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo i {
            font-size: 1.8rem;
        }
        
        .nav-links a {
            color: white;
            text-decoration: none;
            margin-left: 20px;
            padding: 8px 15px;
            border-radius: 5px;
            transition: background 0.3s;
        }
        
        .nav-links a:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .calculator-container {
            padding: 30px;
        }
        
        .section {
            margin-bottom: 40px;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .section-header {
            background: linear-gradient(135deg, #3f51b5 0%, #303f9f 100%);
            color: white;
            padding: 15px 20px;
            font-size: 1.2rem;
        }
        
        .section-body {
            padding: 25px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #3f51b5;
            box-shadow: 0 0 0 2px rgba(63, 81, 181, 0.1);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .btn {
            background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            font-weight: bold;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }
        
        .btn-calculate {
            display: block;
            width: 100%;
            max-width: 400px;
            margin: 30px auto;
            padding: 18px;
            font-size: 1.2rem;
            background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
        }
        
        .results {
            display: none;
            background: #f9f9f9;
            border-radius: 10px;
            padding: 25px;
            margin-top: 30px;
        }
        
        .result-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .chart-container {
            height: 400px;
            margin: 20px 0;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 30px;
        }
        
        .loading i {
            font-size: 2rem;
            color: #3f51b5;
            margin-bottom: 15px;
        }
        
        @media (max-width: 768px) {
            .calculator-container {
                padding: 15px;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- 导航栏 -->
        <div class="navbar">
            <div class="logo">
                <i class="fas fa-leaf"></i>
                <h2>企业碳足迹计算平台</h2>
            </div>
            <div class="nav-links">
                <a href="/"><i class="fas fa-home"></i> 首页</a>
                <a href="#" onclick="showExampleData()"><i class="fas fa-question-circle"></i> 示例</a>
            </div>
        </div>
        
        <!-- 计算器主体 -->
        <div class="calculator-container">
            <h1 style="text-align: center; margin-bottom: 30px; color: #333;">
                <i class="fas fa-calculator"></i> 碳足迹计算器
            </h1>
            
            <!-- 企业基本信息 -->
            <div class="section">
                <div class="section-header">
                    <i class="fas fa-building"></i> 1. 企业基本信息
                </div>
                <div class="section-body">
                    <div class="grid">
                        <div class="form-group">
                            <label>企业名称 <span class="required">*</span></label>
                            <input type="text" id="company_name" class="form-control" value="华东钢铁有限公司" required>
                        </div>
                        <div class="form-group">
                            <label>所属行业 <span class="required">*</span></label>
                            <select id="industry" class="form-control">
                                <option value="钢铁">钢铁</option>
                                <option value="水泥">水泥</option>
                                <option value="电解铝">电解铝</option>
                                <option value="化肥">化肥</option>
                                <option value="其他">其他</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>所在区域 <span class="required">*</span></label>
                            <select id="region" class="form-control">
                                <option value="华东区域电网">华东区域电网</option>
                                <option value="华北区域电网">华北区域电网</option>
                                <option value="华中区域电网">华中区域电网</option>
                                <option value="南方区域电网">南方区域电网</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>计算年份 <span class="required">*</span></label>
                            <input type="number" id="year" class="form-control" value="2024" min="2020" max="2030">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Scope 1 排放数据 -->
            <div class="section">
                <div class="section-header">
                    <i class="fas fa-fire"></i> 2. Scope 1 排放数据（燃料直接燃烧）
                </div>
                <div class="section-body">
                    <div id="fuel-inputs">
                        <div class="form-group">
                            <label>燃料类型</label>
                            <select id="fuel_type" class="form-control">
                                <option value="燃煤">燃煤</option>
                                <option value="天然气">天然气</option>
                                <option value="汽油">汽油</option>
                                <option value="柴油">柴油</option>
                            </select>
                        </div>
                        <div class="grid">
                            <div class="form-group">
                                <label>消耗量 <span class="required">*</span></label>
                                <input type="number" id="fuel_consumption" class="form-control" value="1000" step="0.1" min="0">
                            </div>
                            <div class="form-group">
                                <label>单位</label>
                                <input type="text" id="fuel_unit" class="form-control" value="吨">
                            </div>
                        </div>
                    </div>
                    <button class="btn" onclick="addFuelInput()">
                        <i class="fas fa-plus"></i> 添加其他燃料
                    </button>
                </div>
            </div>
            
            <!-- Scope 2 排放数据 -->
            <div class="section">
                <div class="section-header">
                    <i class="fas fa-bolt"></i> 3. Scope 2 排放数据（外购电力）
                </div>
                <div class="section-body">
                    <div class="form-group">
                        <label>用电数据输入方式</label>
                        <select id="electricity_method" class="form-control" onchange="toggleElectricityInput()">
                            <option value="annual">年度总用电量</option>
                            <option value="daily">日级用电数据</option>
                        </select>
                    </div>
                    
                    <div id="annual_electricity">
                        <div class="form-group">
                            <label>年度总用电量 (kWh) <span class="required">*</span></label>
                            <input type="number" id="annual_consumption" class="form-control" value="1000000" min="0" step="1000">
                        </div>
                    </div>
                    
                    <div id="daily_electricity" style="display: none;">
                        <div class="form-group">
                            <label>日级用电数据 (JSON格式)</label>
                            <textarea id="daily_data" class="form-control" rows="6">
[
    {"date": "2024-01-15", "consumption_kwh": 12000},
    {"date": "2024-01-16", "consumption_kwh": 11800},
    {"date": "2024-01-17", "consumption_kwh": 12500},
    {"date": "2024-01-18", "consumption_kwh": 12200},
    {"date": "2024-01-19", "consumption_kwh": 11500}
]
                            </textarea>
                            <small>提示：可以添加更多日期的数据</small>
                        </div>
                    </div>
                    
                    <div class="grid">
                        <div class="form-group">
                            <label>电碳因子置信度</label>
                            <select id="confidence_level" class="form-control">
                                <option value="low">低置信度</option>
                                <option value="medium" selected>中置信度</option>
                                <option value="high">高置信度</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>是否使用动态因子</label>
                            <select id="use_dynamic" class="form-control">
                                <option value="true">是</option>
                                <option value="false">否</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 生产数据 -->
            <div class="section">
                <div class="section-header">
                    <i class="fas fa-industry"></i> 4. 生产数据
                </div>
                <div class="section-body">
                    <div class="grid">
                        <div class="form-group">
                            <label>主要产品 <span class="required">*</span></label>
                            <input type="text" id="product" class="form-control" value="螺纹钢">
                        </div>
                        <div class="form-group">
                            <label>年产量 <span class="required">*</span></label>
                            <input type="number" id="annual_output" class="form-control" value="10000" min="0">
                        </div>
                        <div class="form-group">
                            <label>产量单位</label>
                            <input type="text" id="output_unit" class="form-control" value="吨">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- CBAM税负计算 -->
            <div class="section">
                <div class="section-header">
                    <i class="fas fa-money-bill-wave"></i> 5. CBAM税负计算（可选）
                </div>
                <div class="section-body">
                    <div class="grid">
                        <div class="form-group">
                            <label>出口欧盟产品名称</label>
                            <input type="text" id="export_product" class="form-control" value="螺纹钢">
                        </div>
                        <div class="form-group">
                            <label>出口量</label>
                            <input type="number" id="export_volume" class="form-control" value="1000" min="0">
                        </div>
                        <div class="form-group">
                            <label>出口单位</label>
                            <input type="text" id="export_unit" class="form-control" value="吨">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 计算按钮 -->
            <button class="btn btn-calculate" onclick="calculateCarbonFootprint()">
                <i class="fas fa-calculator"></i> 计算碳足迹
            </button>
            
            <!-- 加载动画 -->
            <div class="loading" id="loading">
                <i class="fas fa-spinner fa-spin"></i>
                <p>正在计算中，请稍候...</p>
            </div>
            
            <!-- 结果显示区域 -->
            <div class="results" id="results">
                <h2 style="text-align: center; margin-bottom: 25px; color: #1a237e;">
                    <i class="fas fa-chart-bar"></i> 计算结果
                </h2>
                
                <div class="result-card">
                    <h3><i class="fas fa-cloud"></i> 总体碳排放</h3>
                    <div id="total_results"></div>
                </div>
                
                <div class="result-card">
                    <h3><i class="fas fa-chart-pie"></i> 排放构成分析</h3>
                    <div class="chart-container" id="emission_pie_chart"></div>
                </div>
                
                <div class="result-card">
                    <h3><i class="fas fa-lightbulb"></i> 智能分析与建议</h3>
                    <div id="analysis_report"></div>
                </div>
                
                <div class="result-card" id="cbam_section" style="display: none;">
                    <h3><i class="fas fa-euro-sign"></i> CBAM税负分析</h3>
                    <div id="cbam_results"></div>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn" onclick="downloadReport()" style="background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%);">
                        <i class="fas fa-download"></i> 下载完整报告
                    </button>
                    <button class="btn" onclick="location.href='/calculator'" style="background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%); margin-left: 15px;">
                        <i class="fas fa-redo"></i> 重新计算
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
    // 切换用电数据输入方式
    function toggleElectricityInput() {
        const method = document.getElementById('electricity_method').value;
        document.getElementById('annual_electricity').style.display = method === 'annual' ? 'block' : 'none';
        document.getElementById('daily_electricity').style.display = method === 'daily' ? 'block' : 'none';
    }
    
    // 添加燃料输入行
    function addFuelInput() {
        const container = document.getElementById('fuel-inputs');
        const newInput = document.createElement('div');
        newInput.className = 'fuel-input-section';
        newInput.innerHTML = `
            <div class="grid" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
                <div class="form-group">
                    <label>燃料类型</label>
                    <select class="form-control fuel-type">
                        <option value="燃煤">燃煤</option>
                        <option value="天然气">天然气</option>
                        <option value="汽油">汽油</option>
                        <option value="柴油">柴油</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>消耗量</label>
                    <input type="number" class="form-control fuel-consumption" value="500" step="0.1" min="0">
                </div>
                <div class="form-group">
                    <label>单位</label>
                    <input type="text" class="form-control fuel-unit" value="吨">
                </div>
            </div>
        `;
        container.appendChild(newInput);
    }
    
    // 显示示例数据
    function showExampleData() {
        document.getElementById('company_name').value = '华东钢铁有限公司';
        document.getElementById('industry').value = '钢铁';
        document.getElementById('region').value = '华东区域电网';
        document.getElementById('year').value = '2024';
        document.getElementById('fuel_type').value = '燃煤';
        document.getElementById('fuel_consumption').value = '1000';
        document.getElementById('fuel_unit').value = '吨';
        document.getElementById('annual_consumption').value = '1000000';
        document.getElementById('product').value = '螺纹钢';
        document.getElementById('annual_output').value = '10000';
        document.getElementById('output_unit').value = '吨';
        document.getElementById('export_product').value = '螺纹钢';
        document.getElementById('export_volume').value = '1000';
        document.getElementById('export_unit').value = '吨';
        
        alert('示例数据已加载！');
    }
    
    // 收集输入数据
    function collectInputData() {
        // 收集燃料数据
        const fuelInputs = document.querySelectorAll('.fuel-input-section');
        const fuelData = [];
        
        // 添加主要燃料数据
        fuelData.push({
            fuel_type: document.getElementById('fuel_type').value,
            consumption: parseFloat(document.getElementById('fuel_consumption').value) || 0,
            unit: document.getElementById('fuel_unit').value
        });
        
        // 添加额外燃料数据
        fuelInputs.forEach(input => {
            const fuelType = input.querySelector('.fuel-type').value;
            const consumption = parseFloat(input.querySelector('.fuel-consumption').value) || 0;
            
            if (consumption > 0) {
                fuelData.push({
                    fuel_type: fuelType,
                    consumption: consumption,
                    unit: input.querySelector('.fuel-unit').value
                });
            }
        });
        
        // 收集用电数据
        const electricityMethod = document.getElementById('electricity_method').value;
        let electricityData = null;
        
        if (electricityMethod === 'annual') {
            electricityData = {
                annual_consumption_kwh: parseFloat(document.getElementById('annual_consumption').value) || 0
            };
        } else {
            try {
                electricityData = JSON.parse(document.getElementById('daily_data').value);
            } catch (e) {
                alert('日级数据格式错误，请检查JSON格式');
                return null;
            }
        }
        
        // 返回完整数据
        return {
            company_info: {
                name: document.getElementById('company_name').value,
                industry: document.getElementById('industry').value,
                region: document.getElementById('region').value,
                year: parseInt(document.getElementById('year').value)
            },
            fuel_data: fuelData,
            electricity_data: electricityData,
            confidence_level: document.getElementById('confidence_level').value,
            use_dynamic: document.getElementById('use_dynamic').value === 'true',
            production_data: {
                product: document.getElementById('product').value,
                output: parseFloat(document.getElementById('annual_output').value) || 0,
                unit: document.getElementById('output_unit').value
            },
            export_data: {
                product: document.getElementById('export_product').value,
                export_volume: parseFloat(document.getElementById('export_volume').value) || 0,
                unit: document.getElementById('export_unit').value
            }
        };
    }
    
    // 计算碳足迹
    async function calculateCarbonFootprint() {
        const data = collectInputData();
        if (!data) return;
        
        // 显示加载动画
        document.getElementById('loading').style.display = 'block';
        document.getElementById('results').style.display = 'none';
        
        try {
            const response = await fetch('/api/calculate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });
            
            const result = await response.json();
            
            // 隐藏加载动画
            document.getElementById('loading').style.display = 'none';
            
            if (result.success) {
                // 显示结果
                displayResults(result.data);
            } else {
                alert('计算失败: ' + result.message);
            }
            
        } catch (error) {
            document.getElementById('loading').style.display = 'none';
            alert('网络错误: ' + error.message);
        }
    }
    
    // 显示计算结果
    function displayResults(data) {
        // 显示总体结果
        const totalHtml = `
            <div class="summary-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 15px;">
                <div class="summary-item" style="background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%); color: white; padding: 15px; border-radius: 8px;">
                    <h4 style="margin-bottom: 10px;">总碳排放</h4>
                    <p style="font-size: 1.5rem; font-weight: bold;">${data.total_emissions.toLocaleString()} 吨CO₂</p>
                </div>
                <div class="summary-item" style="background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%); color: white; padding: 15px; border-radius: 8px;">
                    <h4 style="margin-bottom: 10px;">产品碳足迹</h4>
                    <p style="font-size: 1.5rem; font-weight: bold;">${data.product_footprint.toFixed(4)} 吨CO₂/吨</p>
                </div>
                <div class="summary-item" style="background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%); color: white; padding: 15px; border-radius: 8px;">
                    <h4 style="margin-bottom: 10px;">Scope 1 排放</h4>
                    <p style="font-size: 1.5rem; font-weight: bold;">${data.scope1.total.toLocaleString()} 吨CO₂</p>
                    <small>占比: ${((data.scope1.total / data.total_emissions) * 100 || 0).toFixed(1)}%</small>
                </div>
                <div class="summary-item" style="background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%); color: white; padding: 15px; border-radius: 8px;">
                    <h4 style="margin-bottom: 10px;">Scope 2 排放</h4>
                    <p style="font-size: 1.5rem; font-weight: bold;">${data.scope2.total.toLocaleString()} 吨CO₂</p>
                    <small>占比: ${((data.scope2.total / data.total_emissions) * 100 || 0).toFixed(1)}%</small>
                </div>
            </div>
        `;
        
        document.getElementById('total_results').innerHTML = totalHtml;
        
        // 生成排放饼图
        const pieData = [{
            labels: ['Scope 1', 'Scope 2'],
            values: [data.scope1.total, data.scope2.total],
            type: 'pie',
            marker: {
                colors: ['#FF6B6B', '#4ECDC4']
            }
        }];
        
        const pieLayout = {
            title: '碳排放构成',
            height: 400,
            showlegend: true
        };
        
        Plotly.newPlot('emission_pie_chart', pieData, pieLayout);
        
        // 显示智能分析
        const analysisHtml = generateAnalysisReport(data);
        document.getElementById('analysis_report').innerHTML = analysisHtml;
        
        // 显示CBAM结果
        if (data.cbam_result) {
            document.getElementById('cbam_section').style.display = 'block';
            const cbamHtml = `
                <div class="cbam-summary" style="margin-top: 15px;">
                    <p><strong>出口产品:</strong> ${data.cbam_result.product_carbon_intensity.toFixed(4)} 吨CO₂/吨</p>
                    <p><strong>出口量:</strong> ${data.cbam_result.export_volume} ${data.cbam_result.export_unit}</p>
                    <p><strong>预计CBAM税负:</strong> ${data.cbam_result.total_tax_cny.toLocaleString()} 元人民币</p>
                    <p><strong>欧盟碳价:</strong> ${data.cbam_result.eu_carbon_price_eur} 欧元/吨CO₂</p>
                    <p><strong>中国碳价:</strong> ${data.cbam_result.china_carbon_price_eur} 欧元/吨CO₂</p>
                    <p><strong>免费配额率:</strong> ${data.cbam_result.free_allowance_rate}%</p>
                </div>
            `;
            document.getElementById('cbam_results').innerHTML = cbamHtml;
        }
        
        // 显示结果区域
        document.getElementById('results').style.display = 'block';
    }
    
    // 生成智能分析报告
    function generateAnalysisReport(data) {
        let analysis = '<div class="analysis-grid">';
        
        // Scope 2占比分析
        const scope2Percent = (data.scope2.total / data.total_emissions * 100) || 0;
        
        if (scope2Percent > 70) {
            analysis += `
                <div class="analysis-item" style="background: #e8f5e8; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                    <h4><i class="fas fa-bolt"></i> 主要发现</h4>
                    <p>您的Scope 2排放占比高达${scope2Percent.toFixed(1)}%，是碳排放的主要来源。</p>
                </div>
            `;
        }
        
        // 减排建议
        analysis += `
            <div class="analysis-item" style="background: #e3f2fd; padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                <h4><i class="fas fa-lightbulb"></i> 核心建议</h4>
                <p>1. <strong>优化生产班次</strong>：将高能耗生产移至电碳因子较低的时段（通常为夜间），预计可降低Scope 2排放约5-15%</p>
                <p>2. <strong>投资屋顶光伏</strong>：考虑安装分布式光伏系统，直接使用清洁电力</p>
                <p>3. <strong>能效改造</strong>：对高耗能设备进行节能技术改造</p>
            </div>
        `;
        
        // 经济分析
        analysis += `
            <div class="analysis-item" style="background: #fff8e1; padding: 15px; border-radius: 6px;">
                <h4><i class="fas fa-chart-line"></i> 经济性分析</h4>
                <p>• 当前产品碳足迹：${data.product_footprint.toFixed(4)} 吨CO₂/吨</p>
                <p>• 行业先进水平：约0.6 吨CO₂/吨</p>
                <p>• 碳减排潜力：${(data.product_footprint - 0.6).toFixed(4)} 吨CO₂/吨</p>
                <p>• 年度碳成本优化潜力：约${(data.production_data.output * (data.product_footprint - 0.6) * 60).toLocaleString()} 元</p>
            </div>
        `;
        
        analysis += '</div>';
        return analysis;
    }
    
    // 下载报告
    async function downloadReport() {
        const data = collectInputData();
        
        try {
            const response = await fetch('/download_report', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    company_name: data.company_info.name,
                    scope1_total: data.fuel_data.reduce((sum, fuel) => sum + fuel.consumption, 0),
                    scope2_total: data.electricity_data.annual_consumption_kwh || 0,
                    total_emissions: 0,
                    product_name: data.production_data.product,
                    annual_output: data.production_data.output,
                    output_unit: data.production_data.unit,
                    product_footprint: 0,
                    cbam_result: data.export_data.export_volume > 0 ? {
                        export_product: data.export_data.product,
                        export_volume: data.export_data.export_volume,
                        export_unit: data.export_data.unit
                    } : null,
                    recommendations: '基于平台分析，建议尽快实施节能改造和清洁能源替代。'
                })
            });
            
            if (response.ok) {
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `碳足迹报告_${new Date().getTime()}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            } else {
                alert('下载失败');
            }
            
        } catch (error) {
            alert('下载错误: ' + error.message);
        }
    }
    
    // 页面加载完成后执行
    document.addEventListener('DOMContentLoaded', function() {
        console.log('碳足迹计算器已加载');
    });
    </script>
</body>
</html>